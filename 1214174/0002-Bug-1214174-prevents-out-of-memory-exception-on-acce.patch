# HG changeset patch
# User Luca Greco <luca.greco@alcacoop.it>

Bug 1214174 - prevents out of memory exception on accessing window.sidebar/window.external in a windowless browser

---
 toolkit/components/search/nsSidebar.js | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/toolkit/components/search/nsSidebar.js b/toolkit/components/search/nsSidebar.js
index deb4557..e408b69 100644
--- a/toolkit/components/search/nsSidebar.js
+++ b/toolkit/components/search/nsSidebar.js
@@ -11,20 +11,24 @@ Cu.import("resource://gre/modules/XPCOMUtils.jsm");
 const SHERLOCK_FILE_EXT_REGEXP = /\.src$/i;
 
 function nsSidebar() {
 }
 
 nsSidebar.prototype = {
   init: function(window) {
     this.window = window;
+    try {
     this.mm = window.QueryInterface(Ci.nsIInterfaceRequestor)
                     .getInterface(Ci.nsIDocShell)
                     .QueryInterface(Ci.nsIInterfaceRequestor)
                     .getInterface(Ci.nsIContentFrameMessageManager);
+    } catch(e) {
+      Cu.reportError(e);
+    }
   },
 
   // Deprecated, only left here to avoid breaking old browser-detection scripts.
   addSearchEngine: function(engineURL, iconURL, suggestedTitle, suggestedCategory) {
     if (SHERLOCK_FILE_EXT_REGEXP.test(engineURL)) {
       Cu.reportError("Installing Sherlock search plugins is no longer supported.");
       return;
     }

